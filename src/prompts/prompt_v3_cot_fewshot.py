from langchain_core.prompts import PromptTemplate
from langchain_core.prompts.few_shot import FewShotPromptTemplate

role = """
[Situation]
당신은 '그린워싱 판별 전문가'입니다. 

당신의 목표는 주어진 문장과 가이드라인을 읽고 그린워싱의 유무를 판단하는 것입니다.
출력 양식을 정확히 따르고, 예시를 복사하지 말고 반드시 새로운 답변을 작성하세요.
"""

cot = """
[Evaluation]
당신은 주어진 문장과 가이드라인을 바탕으로 그린워싱 여부를 판단해야 합니다.

1. 먼저, 문장에서 친환경성을 주장하는 표현을 찾아 언급하세요.
2. 그 표현이 가이드라인에 따라 허위, 과장, 오해 소지가 있는지 단계적으로 검토하세요.
3. 그린워싱일 경우, 어떤 법률 근거에 의해 판단되는지 검토하세요.
4. 최종적으로 판단, 근거, 해결방안을 작성하세요.
"""


output = """
[출력 형식]
1. 판단: [그린워싱 있음 / 없음]
2. 근거: [기사 내 표현 + 가이드라인 위배 여부 + 논리적 설명]
3. 법률: [관련 조항 요약 (필요 시)]
4. 해결방안: [문제 해결을 위한 구체적 조치 제안]
"""


examples = [
    {
        "query": """
        B전자는 최근 ‘에코하모니’ 냉장고를 출시하며 "세계 최고 수준의 친환경 가전"임을 강조했다.  
        회사 측은 이 제품이 ‘탄소 저감 기술’을 탑재해 냉각 과정에서 배출되는 온실가스를 최소화했다고 설명했다.  
        또한 “지속 가능한 미래를 위한 우리의 약속”이라는 슬로건과 함께 자연을 배경으로 한 TV 광고도 선보였다.  
        제품 홍보 페이지에는 탄소 발자국 저감 수치를 별도로 기재하지 않았으며, 외부 인증 여부도 명시되지 않았다.  
        B전자는 “이제 친환경은 선택이 아니라 필수”라며, 관련 기술을 전 모델에 확대 적용할 계획임을 밝혔다.
        """,
        "answer": """
        1. 판단: 그린워싱 가능성 있음
        2. 근거: '세계 최고 수준의 친환경'이라는 표현은 객관적 기준 없이 절대적인 환경성을 주장하고 있으며,  
           온실가스 저감 기술에 대한 수치나 인증이 없이 강조된 점이 '과장 또는 부당한 일반화'에 해당합니다.
        3. 해결방안: 온실가스 배출 저감률 등의 수치를 명시하고, 해당 기술이 어떤 인증이나 기준을 충족하는지 제시해야 합니다.
        """
    },
    {
        "query": """
        H식품은 최근 '클린어스' 캠페인의 일환으로, 자사 제품 포장에 대해 모든 환경 정보를 투명하게 공개하기 시작했다.  
        제품 패키지에는 사용된 재질, 재활용 가능 여부, 폐기 시 유의사항 등이 구체적으로 명시되어 있으며,  
        환경부로부터 인증받은 '저탄소 제품' 마크도 부착되어 있다.  
        캠페인 웹페이지에는 관련 인증서 사본과 함께, 전체 제품군 중 몇 %가 친환경 포장재로 전환되었는지도 설명돼 있다.  
        H식품은 “환경적 책임을 다하기 위한 첫 걸음으로, 정확한 정보 제공에 최선을 다하겠다”고 밝혔다.
        """,
        "answer": """
        1. 판단: 그린워싱 아님  
        2. 근거: 구체적인 수치와 인증 마크를 통해 주장에 대한 근거를 명확히 제시했으며,  
        사용된 용어도 과장이나 모호함 없이 사실 기반으로 구성돼 있습니다.  
        3. 해결방안: 현재로선 추가적인 개선이 필요하지 않으며, 지속적으로 최신 정보를 제공하는 노력이 바람직합니다.
        """
    }
]

one_shot = [
    {
        "query": """
        H식품은 최근 '클린어스' 캠페인의 일환으로, 자사 제품 포장에 대해 모든 환경 정보를 투명하게 공개하기 시작했다.  
        제품 패키지에는 사용된 재질, 재활용 가능 여부, 폐기 시 유의사항 등이 구체적으로 명시되어 있으며,  
        환경부로부터 인증받은 '저탄소 제품' 마크도 부착되어 있다.  
        캠페인 웹페이지에는 관련 인증서 사본과 함께, 전체 제품군 중 몇 %가 친환경 포장재로 전환되었는지도 설명돼 있다.  
        H식품은 “환경적 책임을 다하기 위한 첫 걸음으로, 정확한 정보 제공에 최선을 다하겠다”고 밝혔다.
        """,
        "answer": """
        1. 판단: 그린워싱 아님  
        2. 근거: 구체적인 수치와 인증 마크를 통해 주장에 대한 근거를 명확히 제시했으며,  
        사용된 용어도 과장이나 모호함 없이 사실 기반으로 구성돼 있습니다.  
        3. 해결방안: 현재로선 추가적인 개선이 필요하지 않으며, 지속적으로 최신 정보를 제공하는 노력이 바람직합니다.
        """
    }
]

examples_text = ""
for example in examples:
    examples_text += (
        f"==================== 예시 시작 ====================\n"
        f"query: {example['query']}\n"
        f"answer: {example['answer']}\n"
        f"==================== 예시 끝 ====================\n\n"
    )

one_shot_examples_text = ""
for example in one_shot:
    one_shot_examples_text += (
        f"==================== 예시 시작 ====================\n"
        f"query: {example['query']}\n"
        f"answer: {example['answer']}\n"
        f"==================== 예시 끝 ====================\n\n"
    )

goal = """
아래는 실제 분석할 기사입니다. 그린워싱인지 분석하고, 반드시 출력 형식에 맞춰 답변하세요.

## 기사 본문
{query}

## 참고 가이드라인/법령 문서
{context}
"""

template = output + cot + role + goal
example_template = output+cot + role + examples_text + \
    '위 예시는 참고용입니다. 이제 실제 기사에 대한 분석을 시작하세요.\n\n' + goal

base_prompt = PromptTemplate(
    template=template,
    input_variables=["query", "context"],
)

fewShot_prompt = PromptTemplate(
    template=example_template,
    input_variables=["query", "context"],
)
